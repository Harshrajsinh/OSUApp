version: 2

jobs:
   build_frontend:
     working_directory: ~/osu-app/
     docker:
       - image: circleci/node:6
     steps:
       - checkout
       - run:
          name: Go to Frontend Folder
          command: 'cd frontend'
       - run:
          name: Update npm
          command: 'sudo npm install -g npm@latest'
       - restore_cache:
          key: dependency-cache-{{ checksum "package.json" }}
       - run:
          name: Install npm
          command: npm install
       - save_cache:
          key: dependency-cache-{{ checksum "package.json" }}
          paths:
            - node_modules
  #  test_frontend:
  #      working_directory: ~/osu-app/OSUApp/frontend/osuApp
  #      docker:
  #        - image: circleci/node:6
  #      steps:
  #        - checkout
  #        - run:
  #           name: Test
  #           command: ng test

   build_backend:
      docker:
        # specify the version you desire here
        - image: circleci/openjdk:8-jdk

        # Specify service dependencies here if necessary
        # CircleCI maintains a library of pre-built images
        # documented at https://circleci.com/docs/2.0/circleci-images/
        # - image: circleci/postgres:9.4

      working_directory: ~/osu-app/

      steps:
        - checkout

        - run:
           name: Go to Backend Folder
           command: 'cd backend'

        # Download and cache dependencies
        - restore_cache:
            keys:
            - v1-dependencies-{{ checksum "build.gradle" }}
            # fallback to using the latest cache if no exact match is found
            - v1-dependencies-

        - run: gradle dependencies

        - save_cache:
            paths:
              - ~/.m2
            key: v1-dependencies-{{ checksum "build.gradle" }}

        # run tests!
        - run: gradle test

workflows:
  version: 2
  build:
    jobs:
      - build_frontend
      - build_backend
      # - test_frontend
      #     requires:
      #       - build_frontend
